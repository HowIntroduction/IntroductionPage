<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>우리어떻게하조 메인페이지</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
    <style>
      .slider {
        width: 100vw;
        margin: 0 auto;
      }

      .slider img {
        width: 100%;
        height: 100%;
        max-height: 600px; /* 슬라이더 이미지의 최대 높이 설정 */
        object-fit: cover; /* 이미지가 슬라이더를 꽉 채우도록 설정 */
        border-radius: 10px;
      }

      .slick-dots {
        position: relative;
        margin-top: -5% !important;
        z-index: 9999;
      }

      /* 필요 없을 시 삭제할 것 */
      .main,
      #add_detail {
        background-color: gray;
        background-size: cover;
        background-position: center;
        display: flex;
        flex-direction: row;
        height: 600px;
        margin: 30px 30px 30px 30px;
      }
    </style>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      const CARDS_FOR_SECTION = 3;

      const initFirebase = () => {
        const firebaseConfig = {
          apiKey: "AIzaSyClPXmUFKKAr6m1lFyn-v1W65Dl-X4foWE",
          authDomain: "sparta-dafac.firebaseapp.com",
          projectId: "sparta-dafac",
          storageBucket: "sparta-dafac.firebasestorage.app",
          messagingSenderId: "466405941138",
          appId: "1:466405941138:web:9ff4fb0ae5f6f861622b4b",
          measurementId: "G-FWYNHPBX6W",
        };
        const app = initializeApp(firebaseConfig);

        return getFirestore(app);
      };

      const getMemberList = async () => {
        const db = initFirebase();

        const rawMembers = await getDocs(collection(db, "introduce"));
        const members = rawMembers.docs.map((doc) => ({
          main_image: doc.data().main_image,
          main_text: doc.data().main_text,
          sub_image1: doc.data().sub_image1,
          sub_image2: doc.data().sub_image2,
          sub_text1: doc.data().sub_text1,
          sub_text2: doc.data().sub_text2,
        }));

        return members;
      };

      const setCurrentMember = (member) => {
        localStorage.setItem("currentMember", member);
        presentCurrentMember(member);
      };

      const presentCurrentMember = (member) => {
        $(".mainbox").attr("src", member.main_image);
        $(".text").text(member.main_text);
      };

      // 페이지 최초 로딩 시 실행
      $(document).ready(async () => {
        const memberList = await getMemberList();

        // memberList를 순회하며 동적으로 멤버 카드 element 생성
        // 이를 root element의 자식 element로 추가

        console.log(memberList);

        // 상세 페이지로 넘어가는 onclick 추가
        $(".main").click(async () => {
          window.location.href = "./subpage.html";
        });

        const root = $("#container");
        let currentSection = "";

        memberList.forEach((member, index) => {
          if (index % CARDS_FOR_SECTION == 0) {
            currentSection = `section${index / CARDS_FOR_SECTION}`;
            let tempDiv = `
            <div class="${currentSection}">
              div id="card" class="row row-cols-1 row-cols-md-3 g-4">
              </div>
            </div>
            `;
            root.append(tempDiv);
          }

          console.log(member);

          let tempHTML = `
            <div class="col${index}">
              <div class="card h-100">
                <img
                  src="${member.main_image}"
                  class="card-img-top"
                  alt="..."
                />
                <div class="card-body">
                  <h5 class="card-title">멤버 ${index + 1}</h5>
                  <p class="card-text">${member.main_text}</p>
                </div>
                <div class="card-footer">
                  <small class="text-body-secondary">앨범 날짜</small>
                </div>
              </div>
            </div>
          `;
          $(`.${currentSection}`).append(tempHTML);
          $(`.col${index}`).click(async () => {
            setCurrentMember(memberList[index]);
          });
        });

        // adddetail.html로 넘어가는 클릭 영역 동적으로 생성
        // 필요없다면 삭제할 것
        let addDetailHTML = `
          <div id="add_detail">
            <div class="mainbox">멤버 작성하기</div>
          </div>
        `;
        root.append(addDetailHTML);
        $("#add_detail").click(async () => {
          window.location.href = "./adddetail.html";
        });
      });

      /*
      랜덤 멤버 기능
      const getRandomMember = () => {
          const memberList = getMemberList();
          return memberList[Math.floor(Math.random() * memberList.length)];
      }

      // element에 등록될 메서드
      const setRandomMember = () => {
          const member = getRandomMember();
          localStorage.setItem("currentMember", member);
          presentCurrentMember(member);
      }
      */
    </script>
  </head>
  <body>
    <div id="header" class="header"></div>
    <div class="section1" id="section1">
      <div class="slider" id="slider">
        <div>
          <img
            src="https://images.unsplash.com/photo-1446768500601-ac47e5ec3719?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1446&q=80"
            alt="..."
          />
        </div>
        <div>
          <img
            src="https://images.unsplash.com/photo-1511992243105-2992b3fd0410?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80"
            alt="..."
          />
        </div>
        <div>
          <img
            src="https://images.unsplash.com/photo-1446768500601-ac47e5ec3719?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1446&q=80"
            alt="..."
          />
        </div>
        <div>
          <img
            src="https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAxNzAxMTBfMjMz%2FMDAxNDg0MDUzNTU0MTEz.h9huZdcXFlEpGpMeyk3WLXE7FVQDWzKvzJeslZkdNd8g.4grDg9_bAChg6jh92ZuHbYQyIKV4l9iLt2N6j-wMX0Eg.PNG.mamacora%2Fwallhaven-407202.png&type=a340"
            alt="..."
          />
        </div>
      </div>
    </div>

    <!-- 필요없다면 삭제할 것-->
    <div id="container" class="container_column">
      <div class="main">
        <img class="mainbox"/>
        <div class="text">
          <p>아래 요소를 클릭 했을 시에 크게 보여주는 이미지</p>
        </div>
      </div>
    </div>

    <div id="footer" class="footer"></div>
  </body>
  <script>
    $(window).on("load", function () {
      // 헤더 및 푸터 로드
      $("#header").load("header.html");
      $("#footer").load("footer.html");

      // Slick Slider 초기화
      $(".slider").slick({
        dots: true,
        infinite: true,
        speed: 300,
        slidesToShow: 1,
        adaptiveHeight: false, // 슬라이더의 높이를 고정시킴
        fade: false, // 페이드 효과를 끔
      });
    });
  </script>
</html>
